# Real Childcare Site
This example represents an attempt to bamboozle a potential investor into investing in my on-demand childcare site.  The problem is that I didn't actually build an on-demand childcare site. I have a site that I built a long time ago that does on-demand dogsitting.  They can't be that different, so I'm leveraging njs and nginx to translate away any suspicious references to dogs from the backend responses.

If you explore this project, you'll learn about:
* njs directives `js_body_filter` and `js_header_filter`
* Modifying outgoing headers with `headersOut`
* Chunked transfer encoding

## Run the Project
### With Local nginx
From the **root directory of this repo** run:
1. Test the config with: `nginx -c $(pwd)/real_childcare_site/nginx.conf -t`
1. Load the config with `nginx -c $(pwd)/real_childcare_site/nginx.conf`

After making changes to the files, the configuration may be reloaded with:
`nginx -c $(pwd)/real_childcare_site/nginx.conf -s reload`

### Using Docker
These instructions assume that you have docker or a compatible container engine installed on your system. If you want to use docker, but don't have this set up, see the the [Docker Installation Guide](https://docs.docker.com/engine/install/).

From the **root directory of this repo** run:

1. Build the container image: `docker build -t njs_examples .`
1. Run the container
`docker run --name real_childcare_site -v $(pwd)/real_childcare_site:/project -p 4001:4001 -p 4002:4002 --rm njs_examples`

After making changes to the files, you can reload the configuration using the command:
`docker exec real_childcare_site nginx -s reload -c /project/nginx.conf`

Alternately, you can stop and restart the container.

### After you get it running
This site is full of listings (well, actually just two) so everything is served from `/listings` and the server is listening on port `4002` because that's how much cheese, cheddar, green, money, cash we're going to make from this idea.

Because precious poetry comes from our hearts, responses are served from `/`.  Additionally, because 4000 is the number of individual raindrops I counted during the darkest months the winter, the web server is listening on port `4000`.

In order to view the precious poetry, make sure you specify a currently cloudy or rainy location and issue a request like the following:

`curl -H 'User-Location: Bhopal, India' http://localhost:4002/`

You can put any reasonable place name in the location header.

If you have `jq` installed you can format the beautify poetry nicely by picking individual poems out:

`curl -H 'User-Location: Bhopal, India' http://localhost:4000/ | jq -r '.poems[0]'`

### Learning and modifying
To learn how the project works, you can reference [the walkthrough](walkthrough.md) for step-by-step code examples, or reference the code annotations.

### Files and their roles
| File/Folder                       | Purpose                                                                                                  |
|-----------------------------------|----------------------------------------------------------------------------------------------------------|
| `weather-auth.mjs`                | The primary njs script responsible for handling the auth request generated by `auth_request`             |
| `nginx.conf`                      | The primary nginx configuration file.                                                                    |
| `mock_server/precious-poetry.mjs` | The njs script that serves as the location handler for the main endpoint.  It contains priceless poetry. |

You can experiment with the authorization logic by making changes to the `weather-auth.mjs` file.  The general handling of the request can be changed in `nginx.conf`.  If you feel something in your heart, you can change or add poetry to `mock_server/precious-poetry.mjs`.